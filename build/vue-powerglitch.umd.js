(function(c,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],s):(c=typeof globalThis<"u"?globalThis:c||self,s(c.PowerGlitch={},c.Vue))})(this,function(c,s){"use strict";var m={};Object.defineProperty(m,"__esModule",{value:!0});var u=m.PowerGlitch=void 0;const g=()=>({backgroundColor:"transparent",hideOverflow:!1,timing:{duration:2*1e3,iterations:1/0},glitchTimeSpan:{start:.5,end:.7},shake:{velocity:15,amplitudeX:.4,amplitudeY:.4},slice:{count:6,velocity:15,minHeight:.02,maxHeight:.15,hueRotate:!0}}),d=(e,n)=>{let t=0;if(e.glitchTimeSpan){const i=e.glitchTimeSpan.start,a=e.glitchTimeSpan.end;if(n<i||n>a)return 0;const r=i+(a-i)/2;n<r?t=(n-i)/(r-i):t=(a-n)/(a-r)}else t=1;return(Math.random()-.5)*2*t},$=({minHeight:e,maxHeight:n,minWidth:t,maxWidth:l})=>{const i=Math.floor(Math.random()*((n-e)*100+1))+e*100,a=Math.floor(Math.random()*((l-t)*100+1))+t*100,r=Math.floor(Math.random()*(100-i)),o=Math.floor(Math.random()*(100-a));return{top:r,left:o,height:i,width:a}},E=({top:e,left:n,height:t,width:l})=>{const i=`${n+l}% ${e}%`,a=`${n+l}% ${e+t}%`,r=`${n}% ${e+t}%`,o=`${n}% ${e}%`;return`polygon(${i}, ${a}, ${r}, ${o})`},f=e=>Object.assign(Object.assign({},g().timing),{easing:`steps(${e}, jump-start)`}),M=e=>{if(!e.slice)throw new Error("Slice are not enabled");const n=Math.floor(e.slice.velocity*e.timing.duration/1e3)+1,t=[];for(let l=0;l<n;++l){const i=$({minHeight:e.slice.minHeight,maxHeight:e.slice.maxHeight,minWidth:1,maxWidth:1}),a=d(e,l/n)*30,r={};r.transform=`translate3d(${a}%, 0, 0)`,r.clipPath=E(i),e.slice.hueRotate&&(r.filter=`hue-rotate(${Math.floor(d(e,l/n)*360)}deg)`),t.push(r)}return{steps:t,timing:Object.assign(Object.assign({},f(n)),e.timing)}},v=e=>{if(!e.shake)return{steps:[],timing:f(1)};const n=Math.floor(e.shake.velocity*e.timing.duration/1e3)+1,t=[];for(let l=0;l<n;++l){const i=d(e,l/n)*e.shake.amplitudeX*100,a=d(e,l/n)*e.shake.amplitudeY*100,r={};r.transform=`translate3d(${i}%, ${a}%, 0)`,t.push(r)}return{steps:t,timing:Object.assign(Object.assign({},f(n)),e.timing)}},y=e=>{const n=[];if(n.push(v(e)),e.slice)for(let t=0;t<e.slice.count;++t)n.push(M(e));return n},p=(e,n,t,l)=>{const i=document.createElement("div");for(i.classList.add("layer"),i.style.backgroundColor=t.backgroundColor,i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="center",i.style.backgroundSize="contain",i.style.width="100%",i.style.height="100%",i.style.top="0",i.style.left="0",i.style.position="absolute",e.style.position="relative",t.hideOverflow?e.style.overflow="hidden":e.style.overflow="visible";e.firstChild;)e.removeChild(e.firstChild);for(const a of n){const r=i.cloneNode(!1);r.style.backgroundImage=`url(${l})`,r.animate(a.steps,a.timing),e.appendChild(r)}};function b(...e){const n=t=>t&&typeof t=="object";return e.reduce((t,l)=>(Object.keys(l).forEach(i=>{const a=t[i],r=l[i];if(Array.isArray(a)&&Array.isArray(r)){t[i]=a.concat(...r);return}if(n(a)&&n(r)){t[i]=b(a,r);return}r!==void 0&&(t[i]=r)}),t),{})}const C=(e=".powerglitch",n={})=>{const t=b(g(),n);let l=[];if(typeof e=="string"){const o=document.querySelectorAll(e);if(!o.length)throw new Error(`Could not find any element with selector ${e}`);l=Array.from(o)}else l=[e];const i=l.filter(o=>o instanceof HTMLImageElement),a=l.filter(o=>o instanceof HTMLDivElement),r=y(t);for(const o of i){const h=document.createElement("div");if(h.style.width=o.clientWidth+"px",h.style.height=o.clientHeight+"px",!o.parentElement)throw new Error("Unable to glitch image, it is not attached to a parent element");o.parentElement.insertBefore(h,o),o.style.display="none",p(h,r,t,t.imageUrl||o.src)}for(const o of a){if(!t.imageUrl)throw new Error("Options.imageUrl must be set if there are div elements to glitch");p(o,r,t,t.imageUrl)}};u=m.PowerGlitch={glitch:C,generateLayers:y,getDefaultOptions:g};const w=s.defineComponent({__name:"GlitchedImage",props:{imageUrl:{type:String,required:!0},options:{type:Object,required:!1,default:()=>({})}},setup(e){const n=e,t=s.ref(null);return s.onMounted(()=>{u.glitch(t.value,{...n.options,imageUrl:n.imageUrl})}),(l,i)=>(s.openBlock(),s.createElementBlock("div",{ref_key:"glitched",ref:t},null,512))}}),k={install:e=>{e.component("GlitchedImage",w)}};c.GlitchedImage=w,c.default=k,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
